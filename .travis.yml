language: node_js
node_js:
  - "10"
git:
  depth: 2
  quiet: true
install:
  - npm install hexo-cli -g
before_script:
  - git clone https://github.com/theme-suka/hexo-theme-unit-test.git suka-theme-test --depth=5
  - cd suka-theme-test
  - rm -rf .git
  - npm i
  - git clone https://github.com/SukkaW/hexo-theme-suka.git themes/suka
  - cd themes/suka
  - rm -rf .git
  - npm i --production
  - cd ..
  - cd ..
script:
  - \cp -f ./theme_config.yml themes/suka/_config.yml
  - hexo clean
  - hexo g
  - chmod +x ./test/deploy.sh
  - ./test/deploy.sh
  - mkdir ./deploy-git
  - cd ./deploy-git
  - git init
  - git config --global push.default matching
  - git config --global user.email "isukkaw@gmail.com"
  - git config --global user.name "SukkaW"
  - git remote add origin https://${GitHubKEY}@github.com/theme-suka/demo.git
  - git pull origin master
  - rm -rf ./*
  - cp -rf ../public/* ./
  - git add --all .
  - git commit -m "Travis Auto Tester for hexo-theme-suka"
  - git push --quiet --force origin HEAD:master
cache:
  directories:
    - node_modules
    - themes/suka/node_modules